<link rel="stylesheet" href="/src/public/css/product.css">

<h1>{{product.title}}</h1>

<div class="product-detail">
  {{#if product.thumbnails.[0]}}
    <img src="{{product.thumbnails.[0]}}" alt="Imagen de {{product.title}}" class="product-image" />
  {{else}}
    <img src="/placeholder.jpg" alt="Sin imagen disponible" class="product-image" />
  {{/if}}

  <ul class="product-info">
    <li><strong>Precio:</strong> ${{product.price}}</li>
    <li><strong>Stock:</strong> {{product.stock}}</li>
    <li><strong>Categoría:</strong> {{product.category}}</li>
    <li><strong>Descripción:</strong> {{product.description}}</li>
  </ul>

  <button class="add-to-cart-btn" onclick="agregarAlCarrito()">🛒 Agregar al carrito</button>
</div>

<a class="back-link" href="/">⬅️ Volver al inicio</a>

<script>
  async function agregarAlCarrito() {
    let cid = localStorage.getItem("cid");

    if (!cid) {
      try {
        const crearCarrito = await fetch("/api/carts", { method: "POST" });
        const carritoCreado = await crearCarrito.json();

        if (carritoCreado.status === "success") {
          cid = carritoCreado.cart._id;
          localStorage.setItem("cid", cid);
        } else {
          alert("No se pudo crear el carrito 😢");
          return;
        }
      } catch (error) {
        alert("Error al crear el carrito 😢");
        return;
      }
    }

    try {
      const response = await fetch(`/api/carts/${cid}/products/{{product._id}}`, {
        method: "POST"
      });

      const data = await response.json();

      if (data.status === "success") {
        alert("Producto agregado al carrito 🎉");
      } else {
        alert("Error: " + data.message);
      }
    } catch (error) {
      alert("Error al agregar al carrito 😢");
    }
  }
</script>
